#!/bin/bash

VIEWER=evince


if [ -z $1 ]; then
	echo "Yo Yo"

	exit
fi

F=${1%.*}

if [ -e ${F}.tex ]; then
	echo start converion of ${F}.tex to ${F}.pdf
else
	echo "No such file or directory: ${F}"

	exit
fi

NAME_RANDOMIZE=${F}-`cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 32 | head -n 1 | sort | uniq`

cp ${F}.tex ${NAME_RANDOMIZE}.tex

# sed -e "s/｡/。/g" -e "s/､/、/g" ${NAME_RANDOMIZE}.tex

platex --kanji=utf8 -halt-on-error ${NAME_RANDOMIZE}.tex | grep -B8 "No pages of output." | grep -v "No pages of output."

if [ -e ${NAME_RANDOMIZE}.dvi ]; then
	platex -kanji=utf8 -halt-on-error ${NAME_RANDOMIZE}.tex > /dev/null
else
	echo "compile error occured. failed..."

	rm ${NAME_RANDOMIZE}*

	exit
fi

dvipdfmx ${NAME_RANDOMIZE}.dvi

mv ${NAME_RANDOMIZE}.pdf ${F}.pdf

rm ${NAME_RANDOMIZE}.*

${VIEWER} ${F}.pdf &
